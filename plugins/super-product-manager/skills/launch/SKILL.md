---
name: launch
description: 上线发布技能。用于上线检查、沟通节奏与风险控制。
model: sonnet
version: "1.2.0"
scope: skill
inputs:
  - 上线产品/功能描述
  - 上线时间（如有）
outputs:
  - 上线检查清单
  - 灰度方案
  - 回滚方案
evidence: optional
references: []
---
# launch

## 延迟加载规则

- 默认只使用本文件内容
- 只有在用户明确要求细节或需要模板时，才加载 references 中的附件
- 未加载附件时，先给摘要与下一步

## 核心说明

上线发布技能。用于上线检查、沟通节奏与风险控制。

---

## 上线类型识别

| 类型 | 风险等级 | 适用场景 | 上线策略 |
|-----|---------|---------|---------|
| **全新产品** | 高 | 0到1产品 | 内测→灰度→全量 |
| **重大功能** | 中 | 核心功能改动 | 灰度发布 |
| **常规迭代** | 低 | 小功能优化 | 直接发布 |
| **紧急修复** | 高 | 线上Bug修复 | 快速修复+验证 |

### 快速选择

```
用户输入
    │
    ├── 全新产品首次上线？
    │   └── 是 → 全新产品流程（内测→灰度→全量）
    │
    ├── 涉及核心业务流程？
    │   └── 是 → 重大功能灰度发布
    │
    ├── 是紧急Bug修复？
    │   └── 是 → 紧急修复流程
    │
    └── 小优化迭代
        └── → 常规发布流程
```

---

## 上线检查清单

### Pre-launch（上线前）

| 检查项 | 说明 | 负责人 | 状态 |
|-------|-----|-------|-----|
| **功能验收** | 所有验收标准通过 | 开发 | ⬜ |
| **测试通过** | QA测试无P0/P1bug | 测试 | ⬜ |
| **性能验证** | 压力测试通过 | 开发 | ⬜ |
| **安全检查** | 安全扫描无高危漏洞 | 安全 | ⬜ |
| **数据备份** | 上线前数据已备份 | 运维 | ⬜ |
| **回滚准备** | 回滚方案已确认 | 运维 | ⬜ |
| **监控告警** | 监控指标已配置 | 运维 | ⬜ |
| **文档更新** | 用户文档/帮助文档已更新 | 产品 | ⬜ |

### Launch Day（上线当天）

| 检查项 | 说明 | 负责人 | 状态 |
|-------|-----|-------|-----|
| **公告发布** | 用户公告/邮件已发送 | 运营 | ⬜ |
| **客服准备** | 客服已培训，FAQ已准备 | 客服 | ⬜ |
| **值班安排** | 技术值班人员已确定 | 技术负责人 | ⬜ |
| **监控检查** | 实时监控核心指标 | 值班人员 | ⬜ |

### Post-launch（上线后）

| 检查项 | 说明 | 负责人 | 状态 |
|-------|-----|-------|-----|
| **核心指标** | 检查关键业务指标 | 数据 | ⬜ |
| **错误日志** | 检查错误日志是否有异常 | 开发 | ⬜ |
| **用户反馈** | 收集用户反馈 | 客服/产品 | ⬜ |
| **性能监控** | 检查响应时间、错误率 | 运维 | ⬜ |

---

## 灰度发布策略

### 灰度阶段

| 阶段 | 覆盖范围 | 时间 | 验证重点 |
|-----|---------|-----|---------|
| **内测** | 内部人员10-50人 | 3-7天 | 功能可用性 |
| **小灰度** | 1%-5%用户 | 2-3天 | 核心指标正常 |
| **中灰度** | 10%-20%用户 | 2-3天 | 性能、稳定性 |
| **大灰度** | 50%-80%用户 | 1-2天 | 无异常 |
| **全量** | 100%用户 | - | 全面监控 |

### 灰度判断标准

| 指标 | 回滚阈值 | 继续灰度阈值 | 全量阈值 |
|-----|---------|-------------|---------|
| **错误率** | >1% | <0.5% | <0.1% |
| **响应时间** | >2倍基线 | <1.5倍基线 | <1.2倍基线 |
| **用户投诉** | >10单/小时 | <3单/小时 | <1单/小时 |
| **核心业务** | 下降>10% | 下降<5% | 无影响 |

---

## 回滚方案设计

### 回滚触发条件

满足以下任一条件立即回滚：
- P0级别Bug影响核心业务
- 错误率超过1%持续5分钟
- 核心业务指标下降超过10%
- 用户投诉激增

### 回滚流程

```markdown
## 回滚决策
- [ ] 确认触发回滚条件
- [ ] 通知相关人员
- [ ] 执行回滚操作

## 回滚操作
1. **数据库回滚**（如有变更）
2. **代码回滚**：切换到上一版本
3. **配置回滚**：恢复原有配置
4. **验证检查**：确认服务恢复正常

## 回滚后
- [ ] 通知用户服务已恢复
- [ ] 问题分析报告
- [ ] 制定修复计划
```

### 回滚时间要求

| 风险等级 | 回滚时间目标 |
|---------|-------------|
| **紧急** | 5分钟内 |
| **高** | 15分钟内 |
| **中** | 30分钟内 |
| **低** | 1小时内 |

---

## 风险控制矩阵

| 风险 | 概率 | 影响 | 应对措施 | 负责人 |
|-----|-----|-----|---------|-------|
| 服务器宕机 | 中 | 高 | 多机房部署，自动切换 | 运维 |
| 数据库异常 | 低 | 高 | 主从切换，降级方案 | 运维 |
| 第三方接口失败 | 中 | 中 | 重试机制，降级方案 | 开发 |
| 用户量超预期 | 中 | 中 | 弹性扩容，限流保护 | 运维 |
| 重大Bug发现 | 低 | 高 | 快速回滚流程 | 全员 |

---

## 上线沟通模板

### 内部沟通

```markdown
# 上线通知：[功能名称]

## 上线时间
[日期] [时间]

## 上线内容
- 功能1：...
- 功能2：...

## 影响范围
- 影响：[说明]
- 不影响：[说明]

## 注意事项
- [ ] 上线期间可能会有短暂服务中断
- [ ] 上线后请关注[监控指标]

## 值班安排
- 技术值班：[姓名] [联系方式]
- 产品值班：[姓名] [联系方式]
```

### 外部沟通（用户公告）

```markdown
# 新功能上线通知

亲爱的用户：

我们很高兴地宣布，[功能名称]正式上线啦！

## 新功能介绍
[简洁说明功能价值]

## 如何使用
[使用指南]

## 常见问题
[FAQ]

如有问题，请联系客服：[联系方式]
```

---

## 致命问题检查

上线常见错误：

- [ ] **没有回滚方案**：出问题了不知道怎么撤
- [ ] **没有监控**：上线后不知道发生了什么
- [ ] **同时改动太多**：出问题不知道是什么导致的
- [ ] **在周五上线**：周末出问题没人处理
- [ ] **没有通知用户**：用户不知道有变化
- [ ] **没有客服准备**：用户问问题客服答不上

**记住**：上线不是终点，是验证的起点。准备好应对问题。

---

## PRD 协作引导

本技能可补充 PRD 中的以下章节（仅当 PRD 已包含该章节时）：

| 可补充章节 | 补充内容 | 输出位置 |
|-----------|---------|---------|
| **上线计划** | 上线检查清单、灰度方案、回滚方案、风险控制 | `09-launch-plan.md` 或 PRD 对应章节 |

### 协作约束

- ✅ 只补充上述已有章节，不新增章节
- ✅ 上线检查需包含各阶段负责人和验收条件
- ❌ 不编辑其他章节（如功能需求、技术规格等）

---

## 输出结构（概览）

1. **上线类型识别**：全新产品/重大功能/常规迭代/紧急修复
2. **上线检查清单**：Pre-launch / Launch Day / Post-launch
3. **灰度方案**：灰度阶段、验证标准、判断阈值
4. **回滚方案**：触发条件、回滚流程、时间要求
5. **风险控制**：风险矩阵、应对措施
6. **沟通计划**：内部通知、外部公告

---

## 上线报告模板

```markdown
# 上线报告：[功能名称]

## 基本信息
- 上线时间：[开始] - [结束]
- 上线类型：[全新产品/重大功能/常规迭代]
- 负责人：[姓名]

## 上线内容
1. [功能1]
2. [功能2]

## 上线结果
- [ ] 按计划完成
- [ ] 延期完成（原因：...）
- [ ] 回滚（原因：...）

## 数据表现
| 指标 | 上线前 | 上线后 | 变化 |
|-----|-------|-------|-----|
| DAU | ... | ... | ... |
| 错误率 | ... | ... | ... |
| 响应时间 | ... | ... | ... |

## 遇到的问题
1. [问题描述] - [解决方案]
2. [问题描述] - [解决方案]

## 后续计划
1. [待优化项1]
2. [待优化项2]
```

---

## 示例对话

### 用户说："准备上线了，帮我列个清单"

**输出**：
> 等等，先确认几个事：
>
> 1. **上的是什么？** 新产品？新功能？Bug修复？
> 2. **什么时候上？** 今天？明天？周几？
> 3. **有回滚方案吗？** 出问题了怎么撤回来？
> 4. **有没有人值班？** 上线后谁盯着？
>
> 这些不清楚，上线清单也是白列。

### 用户说："新产品，这周五上线"

**输出**：
> ## 上线检查清单：新产品发布
>
> ---
>
> ⚠️ **重要提醒**：不建议周五上线新产品。如果出问题，周末没人处理。建议改到周二或周三。
>
> ---
>
> ### Pre-launch（上线前）- 必须完成
>
> | 检查项 | 负责人 | 验收标准 | 状态 |
> |-------|-------|---------|-----|
> | 功能验收完成 | 开发 | 所有P0/P1需求已实现 | ⬜ |
> | 测试通过 | 测试 | 无P0/P1缺陷 | ⬜ |
> | 性能测试通过 | 开发 | TPS>1000，响应<500ms | ⬜ |
> | 安全扫描通过 | 安全 | 无高危漏洞 | ⬜ |
> | 数据备份完成 | 运维 | 上线前数据已备份 | ⬜ |
> | 回滚方案确认 | 运维 | 回滚脚本已准备 | ⬜ |
> | 监控告警配置 | 运维 | 核心指标监控已配置 | ⬜ |
> | 用户文档更新 | 产品 | 帮助文档已上线 | ⬜ |
>
> ---
>
> ### 灰度发布方案
>
> **第1天（周四）**：内部测试（10-20人）
> - 验证：核心功能可用，无崩溃
>
> **第2天（周五）**：小灰度（1%用户）
> - 验证：错误率<0.5%，无用户投诉
>
> **第3天（周一）**：中灰度（10%用户）
> - 验证：性能正常，指标稳定
>
> **第4天（周二）**：大灰度（50%用户）
> - 验证：无异常，准备全量
>
> **第5天（周三）**：全量发布（100%用户）
>
> ---
>
> ### 回滚方案
>
> **回滚触发条件**（满足任一立即回滚）：
> - 错误率超过1%持续5分钟
> - 用户注册失败
> - 核心功能不可用
> - 用户投诉超过10单/小时
>
> **回滚操作**：
> 1. 代码回滚到上一版本（预计5分钟）
> 2. 验证服务恢复正常（预计5分钟）
> 3. 通知用户服务已恢复
>
> **回滚时间目标**：15分钟内完成
>
> ---
>
> ### 上线当天安排
>
> **值班人员**：
> - 技术值班：[姓名] [电话]
> - 产品值班：[姓名] [电话]
>
> **监控重点**：
> - 错误率（目标：<0.1%）
> - 响应时间（目标：<500ms）
> - 用户注册成功率（目标：>95%）
>
> **应对准备**：
> - 客服FAQ已准备
> - 用户公告模板已准备
> - 紧急联系群已建立
>
> ---
>
> ### 风险提示
>
> | 风险 | 概率 | 应对 |
> |-----|-----|-----|
> | 服务器压力不足 | 中 | 提前扩容，准备限流 |
> | 第三方接口异常 | 低 | 降级方案 |
> | 用户体验问题 | 中 | 提前内测收集反馈 |
>
> ---
>
> ### 上线后检查（上线后1小时、1天、1周）
>
> **1小时后**：
> - [ ] 核心指标正常
> - [ ] 无P0级别错误
> - [ ] 用户反馈正常
>
> **1天后**：
> - [ ] 数据表现符合预期
> - [ ] 用户投诉在可控范围
> - [ ] 性能指标稳定
>
> **1周后**：
> - [ ] 撰写上线报告
> - [ ] 收集改进建议
> - [ ] 规划下一版本

---

## 常见错误对照

| 错误 | 问题 | 正确做法 |
|-----|------|---------|
| **周五上线** | 出问题没人处理 | 周二周三上线 |
| **没有回滚方案** | 出问题不知道怎么办 | 提前准备回滚脚本 |
| **同时改动太多** | 出问题定位不了 | 小步快跑，每次改动少 |
| **没有监控** | 不知道上线后情况 | 配置监控和告警 |
| **没通知用户** | 用户不知道变化 | 提前发公告 |

---

## 最佳实践

### 1. 小步快跑

不要一次性发布太多功能。小步上线，快速验证。

### 2. 灰度发布

新功能先给小部分用户用，验证后再全量。

### 3. 监控先行

上线前先配置好监控和告警，出问题第一时间知道。

### 4. 准备回滚

假设会出问题，准备好回滚方案。用不上最好，用上了能救命。

### 5. 选择时间

避开周末和节假日上线。选择业务低峰期（如晚上10点后）。

### 6. 通知到位

提前通知团队和用户。团队有准备，用户有预期。

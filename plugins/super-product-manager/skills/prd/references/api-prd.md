# API PRD模板

**用途**：API接口需求，侧重技术对接

---

## 文档信息

| 项目 | 内容 |
|-----|------|
| **PRD标题** | [API接口需求名称] |
| **版本** | v1.0 |
| **创建日期** | [YYYY-MM-DD] |
| **产品经理** | [姓名] |
| **技术负责人** | [姓名] |
| **对接方** | [第三方/内部团队] |
| **状态** | 草稿/评审中/已批准/开发中/已上线 |

---

## 1. 接口概述

### 1.1 对接背景

**业务场景**：
[描述需要对接的业务场景]

**对接目的**：
- 为什么需要对接：[说明]
- 对接能解决什么问题：[说明]
- 预期收益：[描述]

### 1.2 对接方案

**对接方式**：
- 第三方API：[第三方名称]
- 内部服务：[服务名称]
- 混合方案：[描述]

**技术选型**：
- 协议：HTTP/HTTPS/gRPC/WebSocket
- 数据格式：JSON/XML/Protobuf
- 认证方式：OAuth/API Key/Token

---

## 2. 接口列表

### 2.1 接口总览

| 接口名称 | 方法 | 路径 | 优先级 | 说明 |
|---------|------|------|-------|------|
| [接口1] | GET/POST/PUT/DELETE | [/path] | P0/P1/P2 | [说明] |
| [接口2] | GET/POST/PUT/DELETE | [/path] | P0/P1/P2 | [说明] |
| [接口3] | GET/POST/PUT/DELETE | [/path] | P0/P1/P2 | [说明] |

### 2.2 接口详情

#### 接口1：[接口名称]

**基本信息**：
- **方法**：GET/POST/PUT/DELETE
- **路径**：/api/v1/[path]
- **描述**：[接口功能描述]
- **调用时机**：[何时调用]

**请求参数**：

##### Headers
| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|-------|------|------|------|-------|
| Content-Type | string | 是 | 请求格式 | application/json |
| Authorization | string | 是 | 认证信息 | Bearer {token} |
| [参数名] | [类型] | 是/否 | [说明] | [示例] |

##### Query参数（GET）
| 参数名 | 类型 | 必填 | 说明 | 示例值 |
|-------|------|------|------|-------|
| [参数名] | [类型] | 是/否 | [说明] | [示例] |

##### Body参数（POST/PUT）
```json
{
  "param1": "value1",
  "param2": "value2",
  "param3": {
    "nested1": "value3"
  }
}
```

**参数说明**：
| 参数名 | 类型 | 必填 | 约束 | 说明 |
|-------|------|------|------|------|
| param1 | string/number/boolean/object | 是/否 | [约束条件] | [说明] |
| param2 | string/number/boolean/object | 是/否 | [约束条件] | [说明] |
| param3 | object | 是/否 | [约束条件] | [说明] |

**响应数据**：

##### 成功响应（200）
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "field1": "value1",
    "field2": "value2"
  }
}
```

##### 失败响应（4xx/5xx）
```json
{
  "code": 400,
  "message": "error message",
  "error": {
    "type": "ValidationError",
    "details": [
      {
        "field": "param1",
        "message": "error description"
      }
    ]
  }
}
```

**响应字段说明**：
| 字段名 | 类型 | 说明 |
|-------|------|------|
| code | number | 状态码 |
| message | string | 响应消息 |
| data | object | 响应数据 |
| error | object | 错误详情（失败时） |

**状态码定义**：
| 状态码 | 含义 | 使用场景 |
|-------|------|---------|
| 200 | 成功 | 请求成功 |
| 400 | 请求错误 | 参数错误 |
| 401 | 未认证 | 认证失败 |
| 403 | 无权限 | 权限不足 |
| 404 | 不存在 | 资源不存在 |
| 500 | 服务器错误 | 服务器异常 |

#### 接口2：[接口名称]
[同上结构]

---

## 3. 数据结构

### 3.1 核心数据对象

#### 对象1：[对象名称]

```json
{
  "field1": "value1",
  "field2": "value2",
  "field3": 123,
  "field4": true,
  "field5": {
    "nested1": "value5",
    "nested2": "value6"
  },
  "field6": [
    {
      "item1": "value7"
    }
  ]
}
```

**字段说明**：
| 字段名 | 类型 | 必填 | 约束 | 说明 |
|-------|------|------|------|------|
| field1 | string | 是/否 | [约束] | [说明] |
| field2 | string | 是/否 | [约束] | [说明] |
| field3 | number | 是/否 | [约束] | [说明] |
| field4 | boolean | 是/否 | [约束] | [说明] |
| field5 | object | 是/否 | [约束] | [说明] |
| field6 | array | 是/否 | [约束] | [说明] |

#### 对象2：[对象名称]
[同上结构]

### 3.2 枚举值定义

#### 枚举1：[枚举名称]

| 值 | 含义 | 说明 |
|----|------|------|
| VALUE1 | [含义] | [说明] |
| VALUE2 | [含义] | [说明] |

#### 枚举2：[枚举名称]
[同上结构]

---

## 4. 业务逻辑

### 4.1 核心流程

```
[调用方] → [步骤1] → [步骤2] → [步骤3] → [完成]
```

**流程说明**：
1. [步骤1]：[详细描述]
2. [步骤2]：[详细描述]
3. [步骤3]：[详细描述]

### 4.2 业务规则

**规则1**：[描述业务规则]
- 触发条件：[什么时候触发]
- 处理逻辑：[如何处理]
- 异常处理：[异常情况如何处理]

**规则2**：[描述业务规则]
[同上结构]

### 4.3 数据流转

**请求处理**：
```
[请求] → [验证] → [处理] → [响应]
```

**数据同步**：
- 实时同步：[描述实时同步场景]
- 异步同步：[描述异步同步场景]
- 批量同步：[描述批量同步场景]

---

## 5. 错误处理

### 5.1 错误码定义

| 错误码 | 错误类型 | 说明 | 处理建议 |
|-------|---------|------|---------|
| 1001 | 参数错误 | 参数缺失或格式错误 | 检查请求参数 |
| 1002 | 认证失败 | Token无效或过期 | 重新获取Token |
| 1003 | 权限不足 | 无权限访问该资源 | 检查权限配置 |
| 1004 | 资源不存在 | 请求的资源不存在 | 确认资源ID |
| 1005 | 业务异常 | 业务逻辑异常 | 查看错误详情 |

### 5.2 重试策略

**可重试错误**：
| 错误码 | 是否重试 | 重试次数 | 重试间隔 |
|-------|---------|---------|---------|
| 1001 | 否 | - | - |
| 500 | 是 | 3次 | 1s, 2s, 4s |
| 503 | 是 | 3次 | 1s, 2s, 4s |

**重试规则**：
- 指数退避：[描述退避策略]
- 幂等性：[说明哪些操作支持重试]

---

## 6. 安全要求

### 6.1 认证方式

**认证方案**：
- 方式：OAuth 2.0 / API Key / JWT
- 获取方式：[如何获取认证信息]
- 有效期：[Token有效期]
- 刷新机制：[如何刷新Token]

**认证流程**：
```
[获取Token] → [携带Token请求] → [验证Token] → [返回数据]
```

### 6.2 数据加密

**传输加密**：
- 协议：HTTPS/TLS
- 加密强度：[描述]

**数据加密**：
- 敏感字段：[哪些字段需要加密]
- 加密方式：[如何加密]

### 6.3 访问控制

**权限控制**：
- 权限级别：[描述权限级别]
- 权限验证：[如何验证权限]
- 权限管理：[如何管理权限]

---

## 7. 性能要求

### 7.1 性能指标

| 指标 | 要求 | 测量方式 |
|-----|------|---------|
| 响应时间 | ≤ Xms | [如何测量] |
| 并发支持 | ≥ X QPS | [如何测量] |
| 可用性 | ≥ 99.9% | [如何测量] |

### 7.2 限流策略

**限流规则**：
- 限流方式：[Token Bucket / 漏桶 / 固定窗口]
- 限流阈值：[具体阈值]
- 超限处理：[超限后如何处理]

---

## 8. 测试方案

### 8.1 测试环境

| 环境 | 地址 | 说明 |
|-----|------|------|
| 开发环境 | [URL] | 开发测试 |
| 测试环境 | [URL] | 功能测试 |
| 预发环境 | [URL] | 上线前验证 |
| 生产环境 | [URL] | 正式环境 |

### 8.2 测试用例

#### 用例1：[用例名称]
- **测试场景**：[描述测试场景]
- **请求示例**：
```json
{
  "param1": "value1"
}
```
- **预期响应**：
```json
{
  "code": 200,
  "message": "success"
}
```

#### 用例2：[用例名称]
[同上结构]

### 8.3 Mock服务

**Mock数据**：
- Mock地址：[URL]
- Mock规则：[如何Mock]

---

## 9. 上线计划

### 9.1 阶段规划

| 阶段 | 时间 | 内容 | 产出 |
|-----|------|------|------|
| 接口开发 | [日期] | 接口开发 | 测试环境 |
| 联调测试 | [日期] | 双方联调 | 测试报告 |
| 灰度上线 | [日期] | 灰度验证 | 灰度报告 |
| 全量上线 | [日期] | 全量上线 | 上线报告 |

### 9.2 灰度方案

| 阶段 | 流量比例 | 时间 | 退出条件 |
|-----|---------|------|---------|
| 灰度1 | X% | [天数] | [条件] |
| 灰度2 | X% | [天数] | [条件] |
| 全量 | 100% | - | - |

### 9.3 回滚方案

**触发条件**：
[什么情况下需要回滚]

**回滚步骤**：
1. [步骤1]
2. [步骤2]

---

## 10. 依赖与风险

### 10.1 技术依赖

| 依赖 | 提供方 | 状态 | 风险 |
|-----|-------|------|------|
| [依赖1] | [谁提供] | [状态] | [风险] |
| [依赖2] | [谁提供] | [状态] | [风险] |

### 10.2 风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|-----|-------|------|---------|
| [风险1] | 高/中/低 | 高/中/低 | [如何应对] |
| [风险2] | 高/中/低 | 高/中/低 | [如何应对] |

---

## 11. 附录

### 11.1 术语表

| 术语 | 定义 |
|-----|------|
| [术语1] | [定义] |
| [术语2] | [定义] |

### 11.2 参考文档

- [API文档链接]
- [第三方文档链接]
- [相关技术文档]

### 11.3 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|-----|------|---------|-------|
| v1.0 | [日期] | 初始版本 | [姓名] |
| v1.1 | [日期] | [变更内容] | [姓名] |

---

## 模板使用说明

### 什么时候使用这个模板

**API PRD适用于**：
- 第三方API对接
- 内部服务接口定义
- 接口改造和升级

**不适用的场景**：
- 纯功能需求 → 使用功能PRD
- 纯数据需求 → 使用数据PRD

### 使用技巧

1. **接口要完整**：每个接口都要有完整的请求响应示例
2. **字段要明确**：每个字段都要有类型、约束、说明
3. **错误要考虑**：要考虑各种异常情况和错误处理
4. **安全要重视**：认证、加密、权限控制要明确
5. **测试要充分**：提供完整的测试用例和Mock方案
